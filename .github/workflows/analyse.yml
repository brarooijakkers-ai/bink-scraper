name: Analyseer Prestatie

on:
  repository_dispatch:
    types: [workout_finished] # Dit is het 'wachtwoord' voor de deurbel

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
      - name: Code ophalen
        uses: actions/checkout@v4

      - name: Python installeren
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: pip install openai

      - name: Draai Analyse
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          # Hier pakken we de data die de iPhone stuurt
          WORKOUT_DURATION: ${{ github.event.client_payload.duration }}
          WORKOUT_AVG_HR: ${{ github.event.client_payload.avg_hr }}
          WORKOUT_MAX_HR: ${{ github.event.client_payload.max_hr }}
          WORKOUT_CALORIES: ${{ github.event.client_payload.calories }}
        run: python bink_analyze.py
